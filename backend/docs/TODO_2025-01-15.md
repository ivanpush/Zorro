# ZORRO TODO - 2025-01-15

*Created: 2025-01-14*

---

## What We Did Recently

- Redesigned ProcessScreen (shows which agent is running)
- Fixed conflicting edits via prompt consolidation
- Created `/adr` command for design decisions

---

## PHASE 1: FINISH AGENT WORKFLOW

**Goal**: All agents working end-to-end before touching input/output.

### 1. Activate Domain Agent (Perplexity)
- [ ] Test Perplexity API connection
- [ ] Run against sample doc
- [ ] Verify findings include references
- [ ] Wire clickable `[1]` links in frontend
- [ ] Enable in settings

### 2. Verify All Core Agents Work
- [ ] Clarity — always outputs `proposed_edit` with suggestion
- [ ] Rigor — recently fixed, test it
- [ ] Adversary — always outputs `suggestion` field
- [ ] Run full pipeline: upload → process → review
- [ ] Check SSE events flow correctly
- [ ] Dev banner shows accurate metrics

### 3. Prompt Improvements
- [ ] Split `library.py` into separate files per agent
- [ ] Audit each prompt for clarity and efficiency
- [ ] Reduce token usage where possible

### 4. Build Prompt Test Harness
- [ ] Test docs with planted issues
- [ ] Measure: Did it find them? False positives?
- [ ] Compare prompt versions A vs B
- [ ] Track cost per document

---

## PHASE 2: INPUT/OUTPUT

**Goal**: Handle real documents in, useful exports out.

### 5. Wire Setup Inputs to Prompts
- [ ] Pass `document_class` to backend (research-article, grant, essay, other)
- [ ] Pass `focus_areas` (selected chips) to backend
- [ ] Format combined steering memo:
  ```
  <user_instructions>
  Document type: Grant application
  Focus areas: Innovation, Feasibility, Budget justification
  Directive: Be harsh on the timeline.
  </user_instructions>
  ```

### 6. Test Parsers with Edge Cases
- [ ] Tables
- [ ] Multi-column layouts
- [ ] Figures with captions
- [ ] Weird formatting

### 7. Build DOCX Track Changes Export
- User uploads `paper.docx`
- Accepts some suggestions
- Downloads `paper_reviewed.docx` with track changes (insertions/deletions)

### 8. Build PDF Comment Export
- User uploads `paper.pdf`
- Accepts some suggestions
- Downloads `paper_reviewed.pdf` with highlighted text + margin comments

---

## PHASE 3: MONETIZATION & GROWTH

### 9. User Auth
- Login required on first use
- Track usage per user

### 10. Credit System
- **3 free credits** on signup
- **2 credits** = full single-reviewer pass
- **1 credit** = add panel mode OR "go deeper" second pass

### 11. "Go Deeper" Feature
- After initial review, user can spend 1 credit to:
  - Re-run with more aggressive prompts
  - Focus on specific sections they're worried about
  - Get a second opinion (panel mode)

### 12. Panel Mode
- 3 adversarial reviewers instead of 1
- Reconciliation step merges their findings
- Costs 1 extra credit

---

## Technical Notes

- Parsers exist: `backend/app/parsers/` (docx + pdf)
- Export needs: `backend/app/export/` (not built yet)
- Steering placeholder `{steering_memo}` exists in all prompts
- All agents on Haiku 4.5 with temperature=0
- Domain agent disabled until Perplexity tested

---

## Order of Attack

| # | Task | Phase |
|---|------|-------|
| 1 | Activate Domain agent | 1 |
| 2 | Verify all core agents | 1 |
| 3 | Prompt improvements | 1 |
| 4 | Prompt test harness | 1 |
| 5 | Wire setup inputs | 2 |
| 6 | Test parsers | 2 |
| 7 | DOCX export | 2 |
| 8 | PDF export | 2 |
| 9 | User auth | 3 |
| 10 | Credit system | 3 |
| 11 | Go deeper | 3 |
| 12 | Panel mode polish | 3 |
